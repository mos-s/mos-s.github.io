(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{94:function(t,r,e){"use strict";e.d(r,"a",(function(){return d}));var s=e(3),i=e(25),o=e(24),n=e(28),a=e(31),h=e(38),c=e(33),f=e(29),u=e(26),_=e(73),l=e(60),p=e(14),y={effect:null,subMesh:null},d=function(t){function r(r,e,i,n){void 0===n&&(n={});var a=t.call(this,r,e)||this;return a._textures={},a._textureArrays={},a._floats={},a._ints={},a._floatsArrays={},a._colors3={},a._colors3Arrays={},a._colors4={},a._colors4Arrays={},a._vectors2={},a._vectors3={},a._vectors4={},a._matrices={},a._matrixArrays={},a._matrices3x3={},a._matrices2x2={},a._vectors2Arrays={},a._vectors3Arrays={},a._vectors4Arrays={},a._cachedWorldViewMatrix=new o.a,a._cachedWorldViewProjectionMatrix=new o.a,a._multiview=!1,a._shaderPath=i,a._options=Object(s.a)({needAlphaBlending:!1,needAlphaTesting:!1,attributes:["position","normal","uv"],uniforms:["worldViewProjection"],uniformBuffers:[],samplers:[],defines:[]},n),a}return Object(s.c)(r,t),Object.defineProperty(r.prototype,"shaderPath",{get:function(){return this._shaderPath},set:function(t){this._shaderPath=t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"options",{get:function(){return this._options},enumerable:!1,configurable:!0}),r.prototype.getClassName=function(){return"ShaderMaterial"},r.prototype.needAlphaBlending=function(){return this.alpha<1||this._options.needAlphaBlending},r.prototype.needAlphaTesting=function(){return this._options.needAlphaTesting},r.prototype._checkUniform=function(t){-1===this._options.uniforms.indexOf(t)&&this._options.uniforms.push(t)},r.prototype.setTexture=function(t,r){return-1===this._options.samplers.indexOf(t)&&this._options.samplers.push(t),this._textures[t]=r,this},r.prototype.setTextureArray=function(t,r){return-1===this._options.samplers.indexOf(t)&&this._options.samplers.push(t),this._checkUniform(t),this._textureArrays[t]=r,this},r.prototype.setFloat=function(t,r){return this._checkUniform(t),this._floats[t]=r,this},r.prototype.setInt=function(t,r){return this._checkUniform(t),this._ints[t]=r,this},r.prototype.setFloats=function(t,r){return this._checkUniform(t),this._floatsArrays[t]=r,this},r.prototype.setColor3=function(t,r){return this._checkUniform(t),this._colors3[t]=r,this},r.prototype.setColor3Array=function(t,r){return this._checkUniform(t),this._colors3Arrays[t]=r.reduce((function(t,r){return r.toArray(t,t.length),t}),[]),this},r.prototype.setColor4=function(t,r){return this._checkUniform(t),this._colors4[t]=r,this},r.prototype.setColor4Array=function(t,r){return this._checkUniform(t),this._colors4Arrays[t]=r.reduce((function(t,r){return r.toArray(t,t.length),t}),[]),this},r.prototype.setVector2=function(t,r){return this._checkUniform(t),this._vectors2[t]=r,this},r.prototype.setVector3=function(t,r){return this._checkUniform(t),this._vectors3[t]=r,this},r.prototype.setVector4=function(t,r){return this._checkUniform(t),this._vectors4[t]=r,this},r.prototype.setMatrix=function(t,r){return this._checkUniform(t),this._matrices[t]=r,this},r.prototype.setMatrices=function(t,r){this._checkUniform(t);for(var e=new Float32Array(16*r.length),s=0;s<r.length;s++){r[s].copyToArray(e,16*s)}return this._matrixArrays[t]=e,this},r.prototype.setMatrix3x3=function(t,r){return this._checkUniform(t),this._matrices3x3[t]=r,this},r.prototype.setMatrix2x2=function(t,r){return this._checkUniform(t),this._matrices2x2[t]=r,this},r.prototype.setArray2=function(t,r){return this._checkUniform(t),this._vectors2Arrays[t]=r,this},r.prototype.setArray3=function(t,r){return this._checkUniform(t),this._vectors3Arrays[t]=r,this},r.prototype.setArray4=function(t,r){return this._checkUniform(t),this._vectors4Arrays[t]=r,this},r.prototype._checkCache=function(t,r){return!t||(!this._effect||-1!==this._effect.defines.indexOf("#define INSTANCES")===r)},r.prototype.isReadyForSubMesh=function(t,r,e){return this.isReady(t,e)},r.prototype.isReady=function(t,r){var e,s;if(this._effect&&this.isFrozen&&this._effect._wasPreviouslyReady)return!0;var i=this.getScene(),o=i.getEngine();if(!this.checkReadyOnEveryCall&&this._renderId===i.getRenderId()&&this._checkCache(t,r))return!0;var a=[],c=[],f=new _.a;o.getCaps().multiview&&i.activeCamera&&i.activeCamera.outputRenderTarget&&i.activeCamera.outputRenderTarget.getViewCount()>1&&(this._multiview=!0,a.push("#define MULTIVIEW"),-1!==this._options.uniforms.indexOf("viewProjection")&&-1===this._options.uniforms.push("viewProjectionR")&&this._options.uniforms.push("viewProjectionR"));for(var u=0;u<this._options.defines.length;u++)a.push(this._options.defines[u]);for(u=0;u<this._options.attributes.length;u++)c.push(this._options.attributes[u]);t&&t.isVerticesDataPresent(n.b.ColorKind)&&(c.push(n.b.ColorKind),a.push("#define VERTEXCOLOR")),r&&(a.push("#define INSTANCES"),h.a.PushAttributesForInstances(c),(null==t?void 0:t.hasThinInstances)&&a.push("#define THIN_INSTANCES"));var l=0;if(t&&t.useBones&&t.computeBonesUsingShaders&&t.skeleton){c.push(n.b.MatricesIndicesKind),c.push(n.b.MatricesWeightsKind),t.numBoneInfluencers>4&&(c.push(n.b.MatricesIndicesExtraKind),c.push(n.b.MatricesWeightsExtraKind));var p=t.skeleton;l=t.numBoneInfluencers,a.push("#define NUM_BONE_INFLUENCERS "+l),f.addCPUSkinningFallback(0,t),p.isUsingTextureForMatrices?(a.push("#define BONETEXTURE"),-1===this._options.uniforms.indexOf("boneTextureWidth")&&this._options.uniforms.push("boneTextureWidth"),-1===this._options.samplers.indexOf("boneSampler")&&this._options.samplers.push("boneSampler")):(a.push("#define BonesPerMesh "+(p.bones.length+1)),-1===this._options.uniforms.indexOf("mBones")&&this._options.uniforms.push("mBones"))}else a.push("#define NUM_BONE_INFLUENCERS 0");for(var d in this._textures)if(!this._textures[d].isReady())return!1;t&&this._shouldTurnAlphaTestOn(t)&&a.push("#define ALPHATEST");var m=this._shaderPath,v=this._options.uniforms,A=this._options.uniformBuffers,x=this._options.samplers;this.customShaderNameResolve&&(v=v.slice(),A=A.slice(),x=x.slice(),m=this.customShaderNameResolve(m,v,A,x,a,c));var g=this._effect,M=a.join("\n");return this._cachedDefines!==M&&(this._cachedDefines=M,this._effect=o.createEffect(m,{attributes:c,uniformsNames:v,uniformBuffersNames:A,samplers:x,defines:M,fallbacks:f,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousMorphTargets:l}},o),this._onEffectCreatedObservable&&(y.effect=this._effect,this._onEffectCreatedObservable.notifyObservers(y))),null!==(s=!(null===(e=this._effect)||void 0===e?void 0:e.isReady()))&&void 0!==s&&!s&&(g!==this._effect&&i.resetCachedMaterial(),this._renderId=i.getRenderId(),this._effect._wasPreviouslyReady=!0,!0)},r.prototype.bindOnlyWorldMatrix=function(t,r){var e=this.getScene(),s=null!=r?r:this._effect;s&&(-1!==this._options.uniforms.indexOf("world")&&s.setMatrix("world",t),-1!==this._options.uniforms.indexOf("worldView")&&(t.multiplyToRef(e.getViewMatrix(),this._cachedWorldViewMatrix),s.setMatrix("worldView",this._cachedWorldViewMatrix)),-1!==this._options.uniforms.indexOf("worldViewProjection")&&(t.multiplyToRef(e.getTransformMatrix(),this._cachedWorldViewProjectionMatrix),s.setMatrix("worldViewProjection",this._cachedWorldViewProjectionMatrix)))},r.prototype.bindForSubMesh=function(t,r,e){this.bind(t,r,e._effectOverride)},r.prototype.bind=function(t,r,e){this.bindOnlyWorldMatrix(t,e);var s=null!=e?e:this._effect;if(s&&this.getScene().getCachedMaterial()!==this){var i;for(i in-1!==this._options.uniforms.indexOf("view")&&s.setMatrix("view",this.getScene().getViewMatrix()),-1!==this._options.uniforms.indexOf("projection")&&s.setMatrix("projection",this.getScene().getProjectionMatrix()),-1!==this._options.uniforms.indexOf("viewProjection")&&(s.setMatrix("viewProjection",this.getScene().getTransformMatrix()),this._multiview&&s.setMatrix("viewProjectionR",this.getScene()._transformMatrixR)),this.getScene().activeCamera&&-1!==this._options.uniforms.indexOf("cameraPosition")&&s.setVector3("cameraPosition",this.getScene().activeCamera.globalPosition),h.a.BindBonesParameters(r,s),this._textures)s.setTexture(i,this._textures[i]);for(i in this._textureArrays)s.setTextureArray(i,this._textureArrays[i]);for(i in this._ints)s.setInt(i,this._ints[i]);for(i in this._floats)s.setFloat(i,this._floats[i]);for(i in this._floatsArrays)s.setArray(i,this._floatsArrays[i]);for(i in this._colors3)s.setColor3(i,this._colors3[i]);for(i in this._colors3Arrays)s.setArray3(i,this._colors3Arrays[i]);for(i in this._colors4){var o=this._colors4[i];s.setFloat4(i,o.r,o.g,o.b,o.a)}for(i in this._colors4Arrays)s.setArray4(i,this._colors4Arrays[i]);for(i in this._vectors2)s.setVector2(i,this._vectors2[i]);for(i in this._vectors3)s.setVector3(i,this._vectors3[i]);for(i in this._vectors4)s.setVector4(i,this._vectors4[i]);for(i in this._matrices)s.setMatrix(i,this._matrices[i]);for(i in this._matrixArrays)s.setMatrices(i,this._matrixArrays[i]);for(i in this._matrices3x3)s.setMatrix3x3(i,this._matrices3x3[i]);for(i in this._matrices2x2)s.setMatrix2x2(i,this._matrices2x2[i]);for(i in this._vectors2Arrays)s.setArray2(i,this._vectors2Arrays[i]);for(i in this._vectors3Arrays)s.setArray3(i,this._vectors3Arrays[i]);for(i in this._vectors4Arrays)s.setArray4(i,this._vectors4Arrays[i])}var n=this._effect;this._effect=s,this._afterBind(r),this._effect=n},r.prototype._afterBind=function(r){t.prototype._afterBind.call(this,r),this.getScene()._cachedEffect=this._effect},r.prototype.getActiveTextures=function(){var r=t.prototype.getActiveTextures.call(this);for(var e in this._textures)r.push(this._textures[e]);for(var e in this._textureArrays)for(var s=this._textureArrays[e],i=0;i<s.length;i++)r.push(s[i]);return r},r.prototype.hasTexture=function(r){if(t.prototype.hasTexture.call(this,r))return!0;for(var e in this._textures)if(this._textures[e]===r)return!0;for(var e in this._textureArrays)for(var s=this._textureArrays[e],i=0;i<s.length;i++)if(s[i]===r)return!0;return!1},r.prototype.clone=function(t){var e=this,o=i.a.Clone((function(){return new r(t,e.getScene(),e._shaderPath,e._options)}),this);for(var n in o.name=t,o.id=t,"object"==typeof o._shaderPath&&(o._shaderPath=Object(s.a)({},o._shaderPath)),this._options=Object(s.a)({},this._options),Object.keys(this._options).forEach((function(t){var r=e._options[t];Array.isArray(r)&&(e._options[t]=r.slice(0))})),this._textures)o.setTexture(n,this._textures[n]);for(var n in this._floats)o.setFloat(n,this._floats[n]);for(var n in this._floatsArrays)o.setFloats(n,this._floatsArrays[n]);for(var n in this._colors3)o.setColor3(n,this._colors3[n]);for(var n in this._colors4)o.setColor4(n,this._colors4[n]);for(var n in this._vectors2)o.setVector2(n,this._vectors2[n]);for(var n in this._vectors3)o.setVector3(n,this._vectors3[n]);for(var n in this._vectors4)o.setVector4(n,this._vectors4[n]);for(var n in this._matrices)o.setMatrix(n,this._matrices[n]);for(var n in this._matrices3x3)o.setMatrix3x3(n,this._matrices3x3[n]);for(var n in this._matrices2x2)o.setMatrix2x2(n,this._matrices2x2[n]);return o},r.prototype.dispose=function(r,e,s){if(e){var i;for(i in this._textures)this._textures[i].dispose();for(i in this._textureArrays)for(var o=this._textureArrays[i],n=0;n<o.length;n++)o[n].dispose()}this._textures={},t.prototype.dispose.call(this,r,e,s)},r.prototype.serialize=function(){var t,r=i.a.Serialize(this);for(t in r.customType="BABYLON.ShaderMaterial",r.options=this._options,r.shaderPath=this._shaderPath,r.textures={},this._textures)r.textures[t]=this._textures[t].serialize();for(t in r.textureArrays={},this._textureArrays){r.textureArrays[t]=[];for(var e=this._textureArrays[t],s=0;s<e.length;s++)r.textureArrays[t].push(e[s].serialize())}for(t in r.floats={},this._floats)r.floats[t]=this._floats[t];for(t in r.FloatArrays={},this._floatsArrays)r.FloatArrays[t]=this._floatsArrays[t];for(t in r.colors3={},this._colors3)r.colors3[t]=this._colors3[t].asArray();for(t in r.colors3Arrays={},this._colors3Arrays)r.colors3Arrays[t]=this._colors3Arrays[t];for(t in r.colors4={},this._colors4)r.colors4[t]=this._colors4[t].asArray();for(t in r.colors4Arrays={},this._colors4Arrays)r.colors4Arrays[t]=this._colors4Arrays[t];for(t in r.vectors2={},this._vectors2)r.vectors2[t]=this._vectors2[t].asArray();for(t in r.vectors3={},this._vectors3)r.vectors3[t]=this._vectors3[t].asArray();for(t in r.vectors4={},this._vectors4)r.vectors4[t]=this._vectors4[t].asArray();for(t in r.matrices={},this._matrices)r.matrices[t]=this._matrices[t].asArray();for(t in r.matrixArray={},this._matrixArrays)r.matrixArray[t]=this._matrixArrays[t];for(t in r.matrices3x3={},this._matrices3x3)r.matrices3x3[t]=this._matrices3x3[t];for(t in r.matrices2x2={},this._matrices2x2)r.matrices2x2[t]=this._matrices2x2[t];for(t in r.vectors2Arrays={},this._vectors2Arrays)r.vectors2Arrays[t]=this._vectors2Arrays[t];for(t in r.vectors3Arrays={},this._vectors3Arrays)r.vectors3Arrays[t]=this._vectors3Arrays[t];for(t in r.vectors4Arrays={},this._vectors4Arrays)r.vectors4Arrays[t]=this._vectors4Arrays[t];return r},r.Parse=function(t,e,s){var n,h=i.a.Parse((function(){return new r(t.name,e,t.shaderPath,t.options)}),t,e,s);for(n in t.textures)h.setTexture(n,a.a.Parse(t.textures[n],e,s));for(n in t.textureArrays){for(var c=t.textureArrays[n],f=new Array,_=0;_<c.length;_++)f.push(a.a.Parse(c[_],e,s));h.setTextureArray(n,f)}for(n in t.floats)h.setFloat(n,t.floats[n]);for(n in t.floatsArrays)h.setFloats(n,t.floatsArrays[n]);for(n in t.colors3)h.setColor3(n,u.a.FromArray(t.colors3[n]));for(n in t.colors3Arrays){var l=t.colors3Arrays[n].reduce((function(t,r,e){return e%3==0?t.push([r]):t[t.length-1].push(r),t}),[]).map((function(t){return u.a.FromArray(t)}));h.setColor3Array(n,l)}for(n in t.colors4)h.setColor4(n,u.b.FromArray(t.colors4[n]));for(n in t.colors4Arrays){l=t.colors4Arrays[n].reduce((function(t,r,e){return e%4==0?t.push([r]):t[t.length-1].push(r),t}),[]).map((function(t){return u.b.FromArray(t)}));h.setColor4Array(n,l)}for(n in t.vectors2)h.setVector2(n,o.d.FromArray(t.vectors2[n]));for(n in t.vectors3)h.setVector3(n,o.e.FromArray(t.vectors3[n]));for(n in t.vectors4)h.setVector4(n,o.f.FromArray(t.vectors4[n]));for(n in t.matrices)h.setMatrix(n,o.a.FromArray(t.matrices[n]));for(n in t.matrixArray)h._matrixArrays[n]=new Float32Array(t.matrixArray[n]);for(n in t.matrices3x3)h.setMatrix3x3(n,t.matrices3x3[n]);for(n in t.matrices2x2)h.setMatrix2x2(n,t.matrices2x2[n]);for(n in t.vectors2Arrays)h.setArray2(n,t.vectors2Arrays[n]);for(n in t.vectors3Arrays)h.setArray3(n,t.vectors3Arrays[n]);for(n in t.vectors4Arrays)h.setArray4(n,t.vectors4Arrays[n]);return h},r.ParseFromFileAsync=function(t,r,e,s){var i=this;return void 0===s&&(s=""),new Promise((function(o,n){var a=new l.a;a.addEventListener("readystatechange",(function(){if(4==a.readyState)if(200==a.status){var r=JSON.parse(a.responseText),h=i.Parse(r,e||p.a.LastCreatedScene,s);t&&(h.name=t),o(h)}else n("Unable to load the ShaderMaterial")})),a.open("GET",r),a.send()}))},r.CreateFromSnippetAsync=function(t,r,e){var s=this;return void 0===e&&(e=""),new Promise((function(i,o){var n=new l.a;n.addEventListener("readystatechange",(function(){if(4==n.readyState)if(200==n.status){var a=JSON.parse(JSON.parse(n.responseText).jsonPayload),h=JSON.parse(a.shaderMaterial),c=s.Parse(h,r||p.a.LastCreatedScene,e);c.snippetId=t,i(c)}else o("Unable to load the snippet "+t)})),n.open("GET",s.SnippetUrl+"/"+t.replace(/#/g,"/")),n.send()}))},r.SnippetUrl="https://snippet.babylonjs.com",r}(c.a);f.a.RegisteredTypes["BABYLON.ShaderMaterial"]=d}}]);
//# sourceMappingURL=2.babylonBundle.js.map